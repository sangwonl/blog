---
/*
  This is not a layout but just a component that's used in layouts.
*/
---

<script is:inline>
  (function () {
    if (typeof window === "undefined") return;

    function applyTheme(doc) {
      var d = doc || document;
      var isSystemDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
      var storageTheme = localStorage.getItem("theme");
      var isDark = storageTheme === "dark" || (!storageTheme && isSystemDark);

      if (isDark) {
        d.documentElement.classList.add("dark");
      } else {
        d.documentElement.classList.remove("dark");
      }

      var meta = d.head.querySelector('meta[name="theme-color"]');
      if (meta) {
        meta.content = isDark ? "#0e141b" : "#ffffff";
      }
    }

    // Apply on initial / inline re-run
    applyTheme();

    // Preserve theme across View Transition page swaps
    if (!window.__themeSwapListenerAdded) {
      document.addEventListener("astro:before-swap", function (e) {
        applyTheme(e.newDocument);
      });
      window.__themeSwapListenerAdded = true;
    }
  })();
</script>
