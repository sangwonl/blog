---
import { readAll } from "../lib/markdoc/read";
import { project } from "../lib/markdoc/frontmatter.schema";

const projects = await readAll({
  directory: "projects",
  frontmatterSchema: project,
});

const sortedProjects = projects
  .filter((p) => p.frontmatter.draft !== true);

const statusLabel: Record<string, string> = {
  active: "Active",
  archived: "Archived",
  experiment: "Experiment",
};
---

<div>
  <h2 class="font-bold text-xl mb-6">My Projects</h2>
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
    {
      sortedProjects.map((project) => {
        const fm = project.frontmatter;
        const isArchived = fm.status === "archived";
        return (
          <a
            href={fm.url}
            target="_blank"
            rel="noopener noreferrer"
            class:list={[
              "unset group block rounded-xl border p-4 transition-all duration-200",
              "hover:shadow-md hover:-translate-y-0.5",
              isArchived
                ? "border-gray-200 dark:border-gray-700/50 opacity-75 hover:opacity-100"
                : "border-gray-200 dark:border-gray-700 hover:border-orange-300 dark:hover:border-yellow-400/50",
            ]}
          >
            <div class="flex items-start justify-between gap-2 mb-2">
              <h3 class="font-semibold text-text-heading group-hover:text-text-link transition-colors">
                {fm.title}
                <i class="ml-1 text-[10px] text-text-muted fa-solid fa-up-right-from-square" />
              </h3>
              <span
                class:list={[
                  "shrink-0 text-[11px] px-2 py-0.5 rounded-full font-medium",
                  isArchived
                    ? "bg-gray-100 text-gray-500 dark:bg-gray-800 dark:text-gray-400"
                    : "bg-orange-50 text-orange-600 dark:bg-yellow-400/10 dark:text-yellow-400",
                ]}
              >
                {statusLabel[fm.status]}
              </span>
            </div>
            {fm.description && (
              <p class="text-sm text-text-muted mb-3 line-clamp-2">
                {fm.description}
              </p>
            )}
            <div class="flex flex-wrap gap-1.5">
              {fm.stack.map((tech: string) => (
                <span class="text-[11px] px-2 py-0.5 rounded-md bg-gray-100 text-gray-600 dark:bg-gray-800 dark:text-gray-400">
                  {tech}
                </span>
              ))}
            </div>
          </a>
        );
      })
    }
  </div>
</div>
